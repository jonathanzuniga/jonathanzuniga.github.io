<div id="archive">
	{% assign months = 
		"enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre" | 
		split: "|"
	%}
	{% for post in site.posts  %}
	  {% capture this_year %}
	  	{{ post.date | date: "%Y" }}
	  {% endcapture %}
	  {% capture this_month %}
			{% assign m = post.date | date: "%m" | minus: 1 %}
	  	{{ months[m] }}
	  {% endcapture %}
	  {% capture next_year %}
	  	{{ post.previous.date | date: "%Y" }}
	  {% endcapture %}
	  {% capture next_month %}
			{% assign m = post.previous.date | date: "%m" | minus: 1 %}
	  	{{ months[m] }}
	  {% endcapture %}

	  {% if forloop.first %}
		  <h2 id="{{ this_year }}-ref" class="archive-title">
		  	{{ this_year }}
		  </h2>

		  <h3 id="{{ this_year }}-{{ this_month }}-ref" class="archive-subtitle">
		  	{{ this_month }}
		  </h3>

		  <ul>
	  {% endif %}
			  <li>
			  	<a href="{{ post.url }}">{{ post.title }}</a>
			  </li>
	  {% if forloop.last %}
	  	</ul>
	  {% else %}
	    {% if this_year != next_year %}
		    </ul>

		    <h2 id="{{ next_year }}-ref" class="archive-title">
		    	{{next_year}}
		    </h2>

		    <h3 id="{{ next_year }}-{{ next_month }}-ref" class="archive-subtitle">
		    	{{ next_month }}
		    </h3>

		    <ul>
	    {% else %}    
	      {% if this_month != next_month %}
		      </ul>
	      	
	      	<h3 id="{{ this_year }}-{{ next_month }}-ref">
	      		{{ next_month }}
	      	</h3>
		      
		      <ul>
	      {% endif %}
	    {% endif %}
	  {% endif %}
	{% endfor %}
</div>
